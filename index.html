<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Happy Valentine's Day, Sohlange!</title>
<link id="favicon" rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect x='2' y='22' width='2' height='10' fill='%232d8b2d'/><rect x='0' y='26' width='3' height='3' fill='%233da33d'/><rect x='4' y='28' width='3' height='3' fill='%233da33d'/><rect x='8' y='6' width='6' height='6' fill='%23ff4455'/><rect x='18' y='6' width='6' height='6' fill='%23ff4455'/><rect x='4' y='10' width='6' height='6' fill='%23ff4455'/><rect x='22' y='10' width='6' height='6' fill='%23ff4455'/><rect x='6' y='14' width='20' height='6' fill='%23ff4455'/><rect x='10' y='8' width='12' height='6' fill='%23ffaaaa'/><rect x='8' y='18' width='16' height='4' fill='%23ff4455'/><rect x='12' y='12' width='8' height='4' fill='%23ffee44'/><rect x='14' y='14' width='4' height='2' fill='%23ffcc00'/></svg>">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap');
  *{margin:0;padding:0;box-sizing:border-box;}
  body{overflow:hidden;background:#0d3d0d;font-family:'Press Start 2P',monospace;touch-action:manipulation;}
  canvas{display:block;cursor:pointer;}
  #textLayer{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;display:flex;flex-direction:column;align-items:center;}
  #title{font-family:'Press Start 2P',monospace;color:#ff6b9d;font-size:22px;margin-top:11vh;text-shadow:2px 2px 0 #8b0040,0 0 12px #ff6b9d88;text-align:center;line-height:1.6;animation:pulse 2s ease-in-out infinite;}
  #poem{font-family:'Press Start 2P',monospace;color:#fff;font-size:14px;text-shadow:3px 3px 0 #8b0040,0 0 14px #ff6b9d99,-1px -1px 0 #8b0040,1px -1px 0 #8b0040,-1px 1px 0 #8b0040;text-align:center;line-height:2.4;position:absolute;width:100%;opacity:0;transition:opacity 1.2s ease;pointer-events:none;padding:0 10px;}
  #hint{font-family:'Press Start 2P',monospace;color:#ffee44;font-size:10px;text-shadow:1px 1px 0 #000,0 0 6px #ffee4466;position:absolute;text-align:center;transform:translateX(-50%);white-space:nowrap;pointer-events:none;}
  #hintArrow{position:absolute;transform:translateX(-50%);pointer-events:none;animation:bounce 1s ease-in-out infinite;}
  #muteBtn{position:absolute;bottom:16px;right:16px;font-family:'Press Start 2P',monospace;font-size:9px;color:#ffddee;background:rgba(0,30,0,0.7);border:2px solid #ff6b9d;padding:7px 11px;cursor:pointer;pointer-events:auto;text-shadow:1px 1px 0 #8b0040;border-radius:4px;display:none;z-index:20;}
  #muteBtn:hover{background:rgba(0,50,0,0.9);}
  @keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.03);}}
  @keyframes bounce{0%,100%{transform:translateX(-50%) translateY(0);}50%{transform:translateX(-50%) translateY(8px);}}
  @media(max-width:600px){#title{font-size:14px;margin-top:8vh;}#poem{font-size:10px;line-height:2.6;}#hint{font-size:8px;}#muteBtn{font-size:7px;padding:5px 9px;bottom:12px;right:12px;}}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="textLayer">
  <div id="title">Happy Valentine's Day</div>
  <div id="poem">This field of flowers<br>is just for you!<br><span style="font-family:'Dancing Script',cursive;font-size:28px;color:#fff;display:inline-block;margin-top:12px;">‚ù§Ô∏è Josh</span></div>
  <div id="hint">Tap!</div>
  <div id="hintArrow"><svg width="16" height="20" viewBox="0 0 24 28" fill="none"><rect x="10" y="0" width="4" height="4" fill="#ffee44"/><rect x="10" y="4" width="4" height="4" fill="#ffee44"/><rect x="10" y="8" width="4" height="4" fill="#ffee44"/><rect x="10" y="12" width="4" height="4" fill="#ffee44"/><rect x="2" y="16" width="4" height="4" fill="#ffee44"/><rect x="6" y="16" width="4" height="4" fill="#ffee44"/><rect x="10" y="16" width="4" height="4" fill="#ffee44"/><rect x="14" y="16" width="4" height="4" fill="#ffee44"/><rect x="18" y="16" width="4" height="4" fill="#ffee44"/><rect x="6" y="20" width="4" height="4" fill="#ffee44"/><rect x="10" y="20" width="4" height="4" fill="#ffee44"/><rect x="14" y="20" width="4" height="4" fill="#ffee44"/><rect x="10" y="24" width="4" height="4" fill="#ffee44"/></svg></div>
  <button id="muteBtn">üîä Mute</button>
</div>
<script>
const C=document.getElementById('c'),ctx=C.getContext('2d'),dpr=window.devicePixelRatio||1;
let W,H,isMobile;
function resize(){W=window.innerWidth;H=window.innerHeight;C.width=W*dpr;C.height=H*dpr;C.style.width=W+'px';C.style.height=H+'px';ctx.setTransform(dpr,0,0,dpr,0,0);isMobile=W<600;}
resize();
function pRect(x,y,s,col){ctx.fillStyle=col;ctx.fillRect(Math.floor(x),Math.floor(y),s,s);}
function pBox(x,y,w,h,col){ctx.fillStyle=col;ctx.fillRect(Math.floor(x),Math.floor(y),w,h);}

const LETTERS={
  S:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],
  O:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],
  H:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],
  L:[[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,1]],
  A:[[0,0,1,0,0],[0,1,0,1,0],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],
  N:[[1,0,0,0,1],[1,1,0,0,1],[1,0,1,0,1],[1,0,0,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],
  G:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,0],[1,0,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],
  E:[[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,1]]
};
const NAME='SOHLANGE';
const CS=[
  {bud:'#cc3344',petal:'#ff4455',inner:'#ff8888',mid:'#ffaaaa',center:'#ffcc00'},
  {bud:'#ccaa00',petal:'#ffdd33',inner:'#ffee88',mid:'#fff5bb',center:'#ff9900'},
  {bud:'#3366cc',petal:'#4488ff',inner:'#88bbff',mid:'#aaccff',center:'#ffee44'},
  {bud:'#8833aa',petal:'#aa55dd',inner:'#cc99ee',mid:'#ddbbff',center:'#ffcc00'},
  {bud:'#cc3344',petal:'#ff4455',inner:'#ff8888',mid:'#ffaaaa',center:'#ffcc00'},
  {bud:'#ccaa00',petal:'#ffdd33',inner:'#ffee88',mid:'#fff5bb',center:'#ff9900'},
  {bud:'#3366cc',petal:'#4488ff',inner:'#88bbff',mid:'#aaccff',center:'#ffee44'},
  {bud:'#8833aa',petal:'#aa55dd',inner:'#cc99ee',mid:'#ddbbff',center:'#ffcc00'}
];

// === CLOUDS ===
let clouds=[];
function initClouds(){clouds=[];for(let i=0;i<6;i++){let cw=50+Math.random()*70;clouds.push({x:Math.random()*W*1.3-W*0.15,y:H*0.03+Math.random()*H*0.16,w:cw,speed:0.12+Math.random()*0.2});}}
function drawCloudShape(cx,cy,w,sc){let h=w*0.4*sc;pBox(cx-w*0.45,cy,w*0.9,h*0.6,ctx.fillStyle);pBox(cx-w*0.4,cy+h*0.5,w*0.8,h*0.3,ctx.fillStyle);let pr=h*0.7;pBox(cx-pr*0.6,cy-pr*0.7,pr*1.2,pr,ctx.fillStyle);pBox(cx-pr*0.45,cy-pr*0.9,pr*0.9,pr*0.5,ctx.fillStyle);let lr=h*0.55;pBox(cx-w*0.35-lr*0.3,cy-lr*0.4,lr*1.1,lr,ctx.fillStyle);pBox(cx-w*0.35-lr*0.15,cy-lr*0.6,lr*0.8,lr*0.4,ctx.fillStyle);let rr=h*0.6;pBox(cx+w*0.2-rr*0.2,cy-rr*0.5,rr*1.1,rr,ctx.fillStyle);pBox(cx+w*0.2,cy-rr*0.7,rr*0.7,rr*0.4,ctx.fillStyle);let sl=h*0.35;pBox(cx-w*0.45,cy-sl*0.2,sl,sl*0.8,ctx.fillStyle);pBox(cx+w*0.35,cy-sl*0.1,sl*0.9,sl*0.7,ctx.fillStyle);pBox(cx-w*0.4,cy-h*0.2,w*0.8,h*0.5,ctx.fillStyle);}
function drawCloud(c){let s=isMobile?0.7:1,w=c.w*s;ctx.fillStyle='#b8d8ee';drawCloudShape(c.x+2,c.y+3,w,0.9);ctx.fillStyle='#ffffff';drawCloudShape(c.x,c.y,w,1);ctx.fillStyle='#f0f8ff';drawCloudShape(c.x-1,c.y-2,w*0.7,0.6);}

// === CHIPMUNK ===
let chip={active:false,x:0,y:0,speed:0,frame:0,dir:-1};
function startChipmunk(){chip={active:true,x:W+40,y:H*0.75,speed:isMobile?2:3,frame:0,dir:-1};}
function startChipmunkRandom(){let fr=Math.random()>0.5;
  let yPos=getRandomFieldY();
  chip={active:true,x:fr?W+40:-40,y:yPos,speed:isMobile?2:3,frame:0,dir:fr?-1:1};}
function updateChipmunk(){if(!chip.active)return;chip.x+=chip.speed*chip.dir;chip.frame+=0.15;if(chip.dir<0&&chip.x<-60)chip.active=false;if(chip.dir>0&&chip.x>W+60)chip.active=false;}
function drawChipmunk(){if(!chip.active)return;let px=chip.x,py=chip.y,sc=isMobile?1.2:2,lf=Math.floor(chip.frame)%2,f=chip.dir<0?1:-1;ctx.save();ctx.translate(px,py);ctx.scale(f*sc,sc);pBox(10,-8,4,5,'#8B6914');pBox(12,-12,5,6,'#A0782C');pBox(14,-15,4,5,'#8B6914');pBox(13,-10,3,4,'#6B5010');if(lf===0){pBox(-3,10,3,3,'#8B6914');pBox(5,11,3,3,'#8B6914');}else{pBox(-2,11,3,3,'#8B6914');pBox(4,10,3,3,'#8B6914');}pBox(-5,0,16,11,'#A0782C');pBox(-6,2,18,7,'#B8923A');pBox(-4,4,14,3,'#D4B06A');pBox(-3,1,12,2,'#6B5010');pBox(-1,3,8,1,'#6B5010');if(lf===0){pBox(-6,8,3,4,'#A0782C');pBox(8,9,3,4,'#A0782C');}else{pBox(-5,9,3,4,'#A0782C');pBox(9,8,3,4,'#A0782C');}pBox(-10,-5,8,8,'#B8923A');pBox(-12,-3,10,6,'#B8923A');pBox(-12,-1,4,4,'#D4B06A');pBox(-9,-3,2,2,'#000000');pBox(-9,-4,1,1,'#ffffff');pBox(-13,-1,2,2,'#443322');pBox(-8,-7,3,3,'#A0782C');pBox(-7,-6,2,2,'#D4B06A');ctx.restore();}

// === GEESE ===
let geese={active:false,birds:[]};
function startGeese(){geese.active=true;geese.birds=[];let sc=isMobile?1:1.8,sy=H*0.12;let pos=[{ox:0,oy:0},{ox:22,oy:-14},{ox:22,oy:14},{ox:44,oy:-28},{ox:44,oy:28},{ox:66,oy:-40},{ox:66,oy:40},{ox:88,oy:-50},{ox:88,oy:50}];for(let p of pos)geese.birds.push({x:-80-p.ox*sc,y:sy+p.oy*sc,speed:-((isMobile?1.5:2.2)+Math.random()*0.3),frame:Math.random()*Math.PI*2,wingSpeed:0.04+Math.random()*0.01,sc:sc*(0.85+Math.random()*0.3)});}
function startGeeseRandom(){geese.active=true;geese.birds=[];let sc=isMobile?1:1.8,fr=Math.random()>0.5,sy=H*(0.04+Math.random()*0.12);let pos=[{ox:0,oy:0},{ox:22,oy:-14},{ox:22,oy:14},{ox:44,oy:-28},{ox:44,oy:28},{ox:66,oy:-40},{ox:66,oy:40},{ox:88,oy:-50},{ox:88,oy:50}];for(let p of pos){let sx=fr?W+60+p.ox*sc:-80-p.ox*sc;geese.birds.push({x:sx,y:sy+p.oy*sc,speed:((isMobile?1.5:2.2)+Math.random()*0.3)*(fr?1:-1),frame:Math.random()*Math.PI*2,wingSpeed:0.04+Math.random()*0.01,sc:sc*(0.85+Math.random()*0.3)});}}
function updateGeese(){if(!geese.active)return;let done=true;geese.birds.forEach(b=>{b.x-=b.speed;b.frame+=b.wingSpeed;if(b.speed>0&&b.x>-80)done=false;if(b.speed<0&&b.x<W+80)done=false;});if(done)geese.active=false;}
function drawGoose(b){let s=b.sc,wu=Math.sin(b.frame*4)>0,f=b.speed>0?1:-1;ctx.save();ctx.translate(b.x,b.y);ctx.scale(f*s,s);pBox(-6,-2,14,5,'#2a2a2a');pBox(-4,-3,10,7,'#333333');pBox(-10,-8,5,8,'#1a1a1a');pBox(-11,-11,4,5,'#1a1a1a');pBox(-13,-14,6,5,'#1a1a1a');pBox(-14,-12,7,3,'#1a1a1a');pBox(-13,-12,3,2,'#ffffff');pBox(-12,-13,1,1,'#000000');pBox(-16,-11,3,2,'#333333');pBox(7,-3,4,3,'#2a2a2a');pBox(9,-2,3,2,'#1a1a1a');if(wu){pBox(-3,-7,12,4,'#444444');pBox(-1,-10,9,4,'#555555');pBox(1,-12,6,3,'#666666');}else{pBox(-3,1,12,4,'#444444');pBox(-1,4,9,3,'#555555');pBox(1,6,6,2,'#666666');}pBox(5,2,4,2,'#dddddd');ctx.restore();}
function drawGeese(){if(!geese.active)return;geese.birds.forEach(b=>drawGoose(b));}

// === DUCK ===
let duck={active:false,x:0,y:0,speed:1.2,state:'walk',frame:0,timer:0,quackTimer:0,quackCount:0,dir:1,walkDir:1,scale:1};
let babies=[];
function startDuck(){let sc=isMobile?1.5:2.5;duck={active:true,x:-40*sc,y:H*0.60,speed:isMobile?0.8:1.2,state:'walk',frame:0,timer:0,quackTimer:0,quackCount:0,quackBubble:0,dir:-1,walkDir:1,scale:sc,midX:W*0.5};babies=[];let sp=(isMobile?18:28)*sc;for(let i=0;i<3;i++)babies.push({x:duck.x-(i+1)*sp*duck.walkDir,y:duck.y+(isMobile?6:10),frame:Math.random()*2,wobble:Math.random()*Math.PI*2});}
function getRandomFieldY(){
  // 80% chance below flowers, 20% above
  let zones=[[H*0.31,H*0.37],[H*0.57,H*0.85]];
  let z=Math.random()<0.8?zones[1]:zones[0];
  return z[0]+Math.random()*(z[1]-z[0]);
}

function startDuckRandom(){let sc=isMobile?1.5:2.5,fl=Math.random()>0.5,yp=getRandomFieldY();
  duck={active:true,x:fl?-40*sc:W+40*sc,y:yp,speed:isMobile?0.8:1.2,state:'walk',frame:0,timer:0,quackTimer:0,quackCount:0,quackBubble:0,dir:fl?-1:1,walkDir:fl?1:-1,scale:sc,midX:W*(0.3+Math.random()*0.4)};babies=[];let sp=(isMobile?18:28)*sc;for(let i=0;i<3;i++)babies.push({x:duck.x-(i+1)*sp*duck.walkDir,y:duck.y+(isMobile?6:10),frame:Math.random()*2,wobble:Math.random()*Math.PI*2});}
function updateDuck(){if(!duck.active)return;let d=duck,wd=d.walkDir;d.timer++;if(d.state==='walk'){d.x+=d.speed*wd;d.frame+=0.08;if(d.quackCount===0){let at=wd>0?(d.x>=d.midX-20):(d.x<=d.midX+20);if(at){d.state='quack';d.quackTimer=0;d.quackBubble=0;d.quackCount=1;}}if((wd>0&&d.x>W+60*d.scale)||(wd<0&&d.x<-60*d.scale))d.active=false;}else if(d.state==='quack'){d.quackTimer++;d.quackBubble=Math.min(d.quackTimer/30,1);if(d.quackTimer>120){d.state='walk';d.quackBubble=0;}}let sp=(isMobile?18:28)*d.scale;babies.forEach((b,i)=>{let tx=d.x-(i+1)*sp*wd,ty=d.y+(isMobile?6:10);if(d.state==='walk')b.x+=(tx-b.x)*0.06;else b.x+=(d.x-(i+1)*sp*wd-b.x)*0.1;b.y+=(ty-b.y)*0.06;if(d.state==='walk')b.frame+=0.1;});}
function drawBabyDuck(b){let d=duck,s=d.scale*0.5,lf=Math.floor(b.frame)%2;ctx.save();ctx.translate(b.x,b.y);ctx.scale(d.dir*s,s);if(d.state==='walk'){if(lf===0){pBox(-2,10,3,2,'#ff8800');pBox(4,9,3,2,'#ff8800');}else{pBox(-1,9,3,2,'#ff8800');pBox(3,10,3,2,'#ff8800');}}else{pBox(-1,10,3,2,'#ff8800');pBox(3,10,3,2,'#ff8800');}pBox(-1,8,2,3,'#ff8800');pBox(3,8,2,3,'#ff8800');pBox(-4,0,14,10,'#ffdd44');pBox(-5,2,16,6,'#ffdd44');pBox(-3,5,12,3,'#eebb33');pBox(6,2,3,5,'#eebb33');pBox(-8,-6,8,7,'#ffdd44');pBox(-9,-4,10,5,'#ffdd44');pBox(-6,-4,2,2,'#000000');pBox(-11,-3,3,2,'#ffaa00');ctx.restore();}
function drawDuck(t){if(!duck.active)return;let d=duck,s=d.scale,px=d.x,py=d.y,lf=Math.floor(d.frame)%2;ctx.save();ctx.translate(px,py);ctx.scale(d.dir*s,s);if(d.state==='walk'){if(lf===0){pBox(-4,14,4,3,'#ff8800');pBox(6,12,4,3,'#ff8800');}else{pBox(-2,12,4,3,'#ff8800');pBox(4,14,4,3,'#ff8800');}}else{pBox(-3,14,4,3,'#ff8800');pBox(5,14,4,3,'#ff8800');}pBox(-2,11,3,4,'#ff8800');pBox(5,11,3,4,'#ff8800');pBox(-6,0,18,12,'#ffffff');pBox(-8,2,22,8,'#ffffff');pBox(-5,6,16,4,'#eeeedd');pBox(8,2,4,8,'#ddddcc');pBox(10,3,3,6,'#ccccbb');if(d.state==='quack'&&Math.floor(d.quackBubble*6)%2===0){pBox(10,0,4,6,'#ddddcc');pBox(12,1,3,4,'#ccccbb');}pBox(12,0,3,3,'#ffffff');pBox(14,-1,2,2,'#eeeeee');pBox(-8,-4,6,6,'#ffffff');pBox(-12,-10,10,8,'#ffffff');pBox(-14,-8,14,6,'#ffffff');pBox(-10,-8,2,2,'#000000');pBox(-10,-9,2,1,'#ffffff');if(d.state==='quack'&&d.quackBubble>0){pBox(-16,-6,5,2,'#ffaa00');pBox(-16,-4,6,2,'#ff8800');pBox(-16,-2,5,2,'#ffaa00');}else{pBox(-16,-5,5,2,'#ffaa00');pBox(-16,-3,6,2,'#ff8800');}ctx.restore();if(d.state==='quack'&&d.quackBubble>0.2){let wd=d.walkDir||1,bx=px+25*s*wd,byy=py-20*s,ba=Math.min((d.quackBubble-0.2)*3,1);ctx.globalAlpha=ba;let bw=isMobile?28:40,bh=isMobile?14:20;ctx.fillStyle='#ffffff';ctx.beginPath();ctx.ellipse(bx,byy,bw,bh,0,0,Math.PI*2);ctx.fill();ctx.beginPath();ctx.moveTo(bx-8*wd,byy+bh-2);ctx.lineTo(bx-14*wd,byy+bh+8);ctx.lineTo(bx-2*wd,byy+bh-1);ctx.closePath();ctx.fill();ctx.fillStyle='#333';ctx.font=(isMobile?'6':'8')+'px "Press Start 2P",monospace';ctx.textAlign='center';ctx.fillText('QUACK!',bx,byy+3);ctx.globalAlpha=1;}babies.forEach(b=>drawBabyDuck(b));}

// === KANGAROO ===
let roo={active:false,x:0,y:0,baseY:0,speed:0,frame:0,dir:-1,sc:1,hopPhase:0};
function startKangaroo(){
  let sc=isMobile?1.2:2;
  let yPos=H*0.32;
  roo={active:true,x:W+50,y:yPos,baseY:yPos,speed:isMobile?1.5:2.2,frame:0,dir:-1,sc:sc,hopPhase:0};
}
function startKangarooRandom(){
  let sc=isMobile?1.2:2;
  let fromRight=Math.random()>0.5;
  let yPos=getRandomFieldY();
  roo={active:true,x:fromRight?W+50:-50,y:yPos,baseY:yPos,speed:isMobile?1.5:2.2,frame:0,dir:fromRight?-1:1,sc:sc,hopPhase:0};
}
function updateKangaroo(){
  if(!roo.active)return;
  roo.x+=roo.speed*roo.dir;
  roo.hopPhase+=0.07;
  // Hopping motion
  roo.y=roo.baseY-Math.abs(Math.sin(roo.hopPhase))*(isMobile?18:30);
  roo.frame+=0.07;
  if(roo.dir<0&&roo.x<-60)roo.active=false;
  if(roo.dir>0&&roo.x>W+60)roo.active=false;
}
function drawKangaroo(t){
  if(!roo.active)return;
  let px=roo.x,py=roo.y,sc=roo.sc;
  let hopUp=Math.sin(roo.hopPhase)>0.3;
  let inAir=Math.abs(Math.sin(roo.hopPhase))>0.4;

  ctx.save();ctx.translate(px,py);ctx.scale(-roo.dir*sc,sc);

  // Tail - thick, curved, tapers
  pBox(12,4,5,4,'#aa7744');
  pBox(16,2,5,3,'#996633');
  pBox(20,0,4,3,'#996633');
  pBox(23,-2,4,2,'#885522');
  pBox(26,-3,3,2,'#885522');
  pBox(28,-4,2,2,'#774411');

  // Back legs
  if(inAir){
    // Tucked during hop
    pBox(2,2,6,5,'#aa7744');
    pBox(0,0,5,5,'#bb8855');
    // Feet tucked under
    pBox(-2,4,7,3,'#aa7744');
    pBox(-3,3,3,2,'#996633');
  } else {
    // Standing/landing
    pBox(4,4,5,10,'#aa7744');
    pBox(3,6,4,8,'#bb8855');
    // Big strong feet
    pBox(-4,14,10,3,'#aa7744');
    pBox(-5,13,4,2,'#996633');
    // Toes
    pBox(-6,14,2,2,'#996633');
  }

  // Body - muscular rounded shape
  pBox(-2,-8,14,16,'#bb8855');
  pBox(-4,-6,16,12,'#cc9966');
  pBox(-3,-4,14,8,'#cc9966');
  // Belly - lighter
  pBox(0,-2,8,8,'#ddbb88');
  pBox(1,0,6,6,'#ddcc99');

  // Pouch
  ctx.fillStyle='#ccaa77';
  ctx.beginPath();ctx.ellipse(4,4,4,3,0,0,Math.PI);ctx.fill();
  pBox(2,3,5,2,'#bb9966');
  // Baby joey peeking out!
  pBox(3,1,3,3,'#ddaa77');
  pBox(3,0,2,2,'#ddbb88');
  pBox(4,0,1,1,'#000');

  // Front arms - small
  if(inAir){
    pBox(-5,-2,3,4,'#aa7744');
    pBox(-6,0,3,3,'#bb8855');
  } else {
    pBox(-5,0,3,6,'#aa7744');
    pBox(-6,4,3,3,'#bb8855');
  }

  // Neck
  pBox(-5,-12,7,6,'#cc9966');
  pBox(-4,-11,5,4,'#cc9966');

  // Head - more defined shape
  pBox(-9,-19,10,9,'#cc9966');
  pBox(-10,-17,11,6,'#ddaa77');
  pBox(-11,-16,12,4,'#ddaa77');
  // Snout - elongated
  pBox(-13,-15,5,5,'#ddbb88');
  pBox(-15,-14,4,3,'#ddbb88');
  // Nose
  pBox(-16,-13,2,2,'#443322');
  // Mouth
  pBox(-14,-11,4,1,'#885544');
  // Eye - bigger
  pBox(-7,-17,2,2,'#000000');
  pBox(-7,-18,1,1,'#ffffff');
  pBox(-6,-17,1,1,'#332211');
  // Brow
  pBox(-8,-18,3,1,'#aa7744');

  // Ears - tall, expressive
  pBox(-7,-24,3,6,'#cc9966');
  pBox(-6,-23,2,4,'#ffbbaa');
  pBox(-2,-24,3,6,'#cc9966');
  pBox(-1,-23,2,4,'#ffbbaa');
  // Ear tips
  pBox(-7,-25,2,2,'#bb8855');
  pBox(-2,-25,2,2,'#bb8855');

  ctx.restore();
}

// === PIZZA RAT ===
let pRat={active:false,x:0,y:0,speed:0,frame:0,dir:1};
function startPizzaRat(){
  let fromLeft=Math.random()>0.5;
  let sc=isMobile?1:1.6;
  pRat={active:true,x:fromLeft?-30:W+30,y:H-(isMobile?10:15),speed:(isMobile?1.8:2.5),frame:0,dir:fromLeft?1:-1,sc:sc};
}
function updatePizzaRat(){
  if(!pRat.active)return;
  pRat.x+=pRat.speed*pRat.dir;
  pRat.frame+=0.18;
  if(pRat.dir>0&&pRat.x>W+40)pRat.active=false;
  if(pRat.dir<0&&pRat.x<-40)pRat.active=false;
}
function drawPizzaRat(t){
  if(!pRat.active)return;
  let px=pRat.x,py=pRat.y,sc=pRat.sc;
  let lf=Math.floor(pRat.frame)%2;
  ctx.save();ctx.translate(px,py);ctx.scale(-pRat.dir*sc,sc);

  // Tail - curvy pink
  ctx.strokeStyle='#cc8899';ctx.lineWidth=1.5;
  ctx.beginPath();ctx.moveTo(10,0);
  let tw=Math.sin(t*0.006)*3;
  ctx.quadraticCurveTo(16,tw-4,20,-8+tw);
  ctx.quadraticCurveTo(23,-12+tw,21,-16);
  ctx.stroke();

  // Back legs
  if(lf===0){pBox(4,6,3,3,'#777');pBox(7,5,3,3,'#777');}
  else{pBox(5,5,3,3,'#777');pBox(6,6,3,3,'#777');}

  // Body
  pBox(-4,-2,16,10,'#888');
  pBox(-3,0,14,7,'#999');
  pBox(-1,2,10,4,'#aaa');

  // Front legs
  if(lf===0){pBox(-6,5,3,3,'#888');pBox(-4,6,3,3,'#888');}
  else{pBox(-5,6,3,3,'#888');pBox(-5,5,3,3,'#888');}

  // Head
  pBox(-10,-5,8,9,'#999');
  pBox(-12,-3,9,6,'#aaa');
  // Snout
  pBox(-14,-2,4,4,'#aaa');
  // Nose
  pBox(-15,-1,2,2,'#ff8899');
  // Eye
  pBox(-8,-4,2,2,'#000');
  pBox(-8,-5,1,1,'#fff');
  // Ears
  pBox(-7,-7,3,3,'#999');
  pBox(-6,-6,2,2,'#ffaaaa');
  pBox(-3,-7,3,3,'#999');
  pBox(-2,-6,2,2,'#ffaaaa');

  // Pizza slice in mouth - triangle shape
  // Crust (back edge)
  ctx.fillStyle='#b87520';
  ctx.beginPath();ctx.moveTo(-13,-1);ctx.lineTo(-12,3);ctx.lineTo(-10,3);ctx.lineTo(-11,-1);ctx.closePath();ctx.fill();
  // Main cheese/sauce base - triangle
  ctx.fillStyle='#dd3322';
  ctx.beginPath();ctx.moveTo(-30,-8);ctx.lineTo(-11,-1);ctx.lineTo(-11,3);ctx.lineTo(-30,1);ctx.closePath();ctx.fill();
  // Cheese layer on top
  ctx.fillStyle='#ffdd44';
  ctx.beginPath();ctx.moveTo(-29,-7);ctx.lineTo(-12,-1);ctx.lineTo(-12,2);ctx.lineTo(-29,0);ctx.closePath();ctx.fill();
  // Cheese drip
  pBox(-24,0,2,3,'#ffcc33');
  pBox(-19,1,2,2,'#ffdd44');
  // Pepperoni
  ctx.fillStyle='#cc2211';
  ctx.beginPath();ctx.arc(-23,-3,2,0,Math.PI*2);ctx.fill();
  ctx.beginPath();ctx.arc(-18,-1,1.5,0,Math.PI*2);ctx.fill();
  ctx.beginPath();ctx.arc(-26,-1,1.5,0,Math.PI*2);ctx.fill();
  // Cheese bubbles
  pRect(-21,-4,1.5,'#ffee88');
  pRect(-16,-2,1,'#ffee88');

  ctx.restore();
}

// === RANDOM ANIMAL SPAWNER ===
let animalTimer=0,animalInterval=200;
function spawnRandomAnimal(){
  // Build list of available animals
  let avail=[];
  if(!duck.active)avail.push('duck','duck','duck');
  if(!chip.active)avail.push('chip','chip','chip');
  if(!geese.active)avail.push('geese','geese','geese');
  if(!roo.active)avail.push('roo','roo');
  if(!pRat.active)avail.push('rat');
  if(avail.length===0)return;
  let pick=avail[Math.floor(Math.random()*avail.length)];
  if(pick==='duck')startDuckRandom();
  else if(pick==='chip')startChipmunkRandom();
  else if(pick==='geese')startGeeseRandom();
  else if(pick==='roo')startKangarooRandom();
  else startPizzaRat();
}

// === BACKGROUND FLOWERS ===
let bgFlowers=[],bgFQ=[],skyH=0;
function makeBgPos(){let p=[];const sp=isMobile?24:30,bs=isMobile?36:55;const tw=NAME.length*bs+40,sx=(W-tw)/2,by=H*0.48,mg=isMobile?10:20;skyH=H*(isMobile?0.28:0.30);let bz={x:sx-mg,y:by-(isMobile?90:130),w:tw+mg*2,h:isMobile?120:165};for(let gy=Math.floor(skyH);gy<H+sp;gy+=sp)for(let gx=-20;gx<W+sp;gx+=sp){let jx=gx+(Math.random()-0.5)*sp*0.7,jy=gy+(Math.random()-0.5)*sp*0.7;if(jy<skyH+10)continue;if(jx>bz.x-10&&jx<bz.x+bz.w+10&&jy>bz.y-10&&jy<bz.y+bz.h+10)continue;p.push({x:jx,y:jy});}for(let i=p.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[p[i],p[j]]=[p[j],p[i]];}return p;}
let allPos=[],posIdx=0;
function spawnBgBatch(c){const n=Math.ceil(allPos.length/NAME.length),cols=[c.petal,c.inner,c.mid,c.bud];for(let i=0;i<n&&posIdx<allPos.length;i++,posIdx++){let p=allPos[posIdx];bgFQ.push({x:p.x,y:p.y,size:(isMobile?2:3)+Math.floor(Math.random()*(isMobile?3:5)),col:cols[Math.floor(Math.random()*cols.length)],phase:Math.random()*Math.PI*2,type:Math.floor(Math.random()*4),stemH:(isMobile?6:8)+Math.random()*(isMobile?10:16),gp:0,gs:0.02+Math.random()*0.02,delay:i*2+Math.random()*20});}}

// === LETTER BUDS ===
let buds=[],allDone=false,revT=0,hearts=[],sparkles=[];
function initBuds(){buds=[];const sp=isMobile?36:55,tw=NAME.length*sp,sx=(W-tw)/2,by=H*0.48+(isMobile?12:20);for(let i=0;i<NAME.length;i++){let c=CS[i];buds.push({x:sx+i*sp+sp/2,y:by,drawX:sx+i*sp+sp/2,drawY:by,stemH:isMobile?45+Math.random()*12:65+Math.random()*20,drawStemH:0,letter:NAME[i],bloomed:false,bloomProgress:0,visible:i===0,growIn:i===0?1:0,wobble:Math.random()*Math.PI*2,budCol:c.bud,petalCol:c.petal,innerCol:c.inner,midCol:c.mid,centerCol:c.center,leafPhase:Math.random()*Math.PI});buds[i].drawStemH=buds[i].stemH;}}
function updateHint(){let h=document.getElementById('hint'),a=document.getElementById('hintArrow');if(allDone){h.style.display='none';a.style.display='none';return;}let idx=-1;for(let i=0;i<buds.length;i++)if(!buds[i].bloomed&&buds[i].visible&&buds[i].growIn>=0.9){idx=i;break;}if(idx<0){h.style.display='none';a.style.display='none';return;}let b=buds[idx],topY=b.y-b.stemH*b.growIn*0.3-(isMobile?10:14);h.style.top=(topY-(isMobile?58:78))+'px';h.style.left=b.x+'px';h.style.display='block';a.style.top=(topY-(isMobile?38:50))+'px';a.style.left=b.x+'px';a.style.display='block';h.textContent=isMobile?'Tap!':'Click!';}

// === AUDIO ===
// *** REPLACE THE URL BELOW WITH YOUR MP3 LOCATION ***
const MUSIC_URL = 'Fearless_8bit(Taylors Version).mp3';
let audio=null,musicPlaying=false;
function startMusic(){
  if(audio)return;
  audio=new Audio(MUSIC_URL);
	audio.volume = 0.5;
  audio.loop=true;
  audio.play().catch(()=>{});
  musicPlaying=true;
  let btn=document.getElementById('muteBtn');
  btn.style.display='block';
  btn.textContent='üîä Mute';
}
document.getElementById('muteBtn').addEventListener('click',function(){
  if(!audio)return;
  if(musicPlaying){audio.pause();musicPlaying=false;this.textContent='üîá Play';}
  else{audio.play();musicPlaying=true;this.textContent='üîä Mute';}
});

// === SKY STATE ===
let sunProg=0,sunRising=false;
function lerpC(a,b,t){let ar=parseInt(a.slice(1,3),16),ag=parseInt(a.slice(3,5),16),ab=parseInt(a.slice(5,7),16),br=parseInt(b.slice(1,3),16),bg=parseInt(b.slice(3,5),16),bb=parseInt(b.slice(5,7),16);return '#'+Math.round(ar+(br-ar)*t).toString(16).padStart(2,'0')+Math.round(ag+(bg-ag)*t).toString(16).padStart(2,'0')+Math.round(ab+(bb-ab)*t).toString(16).padStart(2,'0');}

function initAll(){bgFlowers=[];bgFQ=[];posIdx=0;allPos=makeBgPos();initBuds();initClouds();allDone=false;revT=0;duck.active=false;chip.active=false;geese.active=false;roo.active=false;pRat.active=false;animalTimer=0;sunProg=0;sunRising=false;if(audio){audio.pause();audio=null;}musicPlaying=false;document.getElementById('muteBtn').style.display='none';document.getElementById('poem').style.opacity='0';updateHint();}
initAll();

// === DRAWING ===
function drawSky(t){skyH=H*(isMobile?0.28:0.30);if(sunRising&&sunProg<1)sunProg=Math.min(sunProg+0.003,1);let p=sunProg;
  // Multi-stage sky color transition to avoid muddy midpoints
  let top,mid,bot;
  if(p<0.5){let q=p*2;
    top=lerpC('#2a1a40','#664488',q);
    mid=lerpC('#cc6622','#dd8866',q);
    bot=lerpC('#ffaa44','#ffcc88',q);
  }else{let q=(p-0.5)*2;
    top=lerpC('#664488','#4488cc',q);
    mid=lerpC('#dd8866','#66aadd',q);
    bot=lerpC('#ffcc88','#88ccee',q);
  }
  let g=ctx.createLinearGradient(0,0,0,skyH);g.addColorStop(0,top);g.addColorStop(0.5,mid);g.addColorStop(1,bot);ctx.fillStyle=g;ctx.fillRect(0,0,W,skyH);
  let sunR=isMobile?30:50;
  let sunStartY=skyH-sunR*0.35;
  let sunEndY=-sunR*2.5;
  let sunY=sunStartY+(sunEndY-sunStartY)*p;
  let sunX=W*(isMobile?0.78:0.80);
  let sunCol=lerpC('#ff8800','#ffee44',p);
  let sunHi=lerpC('#ffcc33','#ffffaa',p);
  let sunEdge=lerpC('#ff6600','#ffdd33',p);
  // Warm glow across sky
  let glowA=Math.max(0,0.5-p*0.3);
  if(glowA>0){
    // Wide horizontal glow along horizon
    let gw=sunR*8,gh=sunR*4;
    let hg=ctx.createRadialGradient(sunX,sunY,sunR*0.5,sunX,sunY,gw);
    hg.addColorStop(0,'rgba(255,200,80,'+glowA*0.7+')');
    hg.addColorStop(0.3,'rgba(255,140,40,'+glowA*0.4+')');
    hg.addColorStop(0.7,'rgba(255,80,20,'+glowA*0.15+')');
    hg.addColorStop(1,'rgba(255,60,10,0)');
    ctx.fillStyle=hg;ctx.fillRect(0,Math.max(0,sunY-gh),W,gh*2);
    // Tight inner glow
    let ig=ctx.createRadialGradient(sunX,sunY,sunR*0.2,sunX,sunY,sunR*3);
    ig.addColorStop(0,'rgba(255,240,180,'+glowA*0.6+')');
    ig.addColorStop(0.5,'rgba(255,180,60,'+glowA*0.3+')');
    ig.addColorStop(1,'rgba(255,120,20,0)');
    ctx.fillStyle=ig;ctx.fillRect(sunX-sunR*3,Math.max(0,sunY-sunR*3),sunR*6,sunR*6);
  }
  // Dashed animated rays
  if(sunY>-sunR*1.5){
    let rayCount=16;let rayAlpha=Math.max(0,0.8-p*0.5);
    if(rayAlpha>0){let dashLen=isMobile?7:11,gapLen=isMobile?5:7,dashSpeed=t*0.06;
      for(let i=0;i<rayCount;i++){let ang=(i/rayCount)*Math.PI*2+t*0.0004;let maxLen=sunR*(3.5+Math.sin(t*0.002+i*0.9)*0.8);let rw=isMobile?3:4;let rx=Math.cos(ang),ry=Math.sin(ang);let iAlpha=rayAlpha*(0.7+Math.sin(t*0.004+i*2.1)*0.3);let rayCol=lerpC('#ffaa00','#ffee44',p);ctx.fillStyle=rayCol;let offset=(dashSpeed+i*7)%(dashLen+gapLen);for(let d=sunR*1.1-offset;d<sunR*1.1+maxLen;d+=dashLen+gapLen){if(d<sunR*1.0)continue;let fadeOut=1-Math.max(0,(d-sunR*1.1)/(maxLen))*0.7;ctx.globalAlpha=iAlpha*fadeOut;for(let dd=0;dd<dashLen;dd+=3){let dist=d+dd;let px=sunX+rx*dist,py=sunY+ry*dist;ctx.fillRect(Math.floor(px)-1,Math.floor(py)-1,rw,rw);}}}ctx.globalAlpha=1;}
  }
  // Sun body - clipped at horizon before rising
  if(sunY>-sunR*1.5){
    ctx.save();
    // Clip sun below horizon line
    ctx.beginPath();ctx.rect(0,0,W,skyH);ctx.clip();
    // Outer corona ring
    let coronaR=sunR+4;
    for(let dy=-coronaR;dy<=coronaR;dy+=3){let dx=Math.sqrt(Math.max(0,coronaR*coronaR-dy*dy));if(dx>0){ctx.globalAlpha=0.4;pBox(sunX-dx,sunY+dy,dx*2,3,lerpC('#ff4400','#ffcc22',p));}}
    ctx.globalAlpha=1;
    // Edge rim
    for(let dy=-sunR-2;dy<=sunR+2;dy+=3){let dx=Math.sqrt(Math.max(0,(sunR+2)*(sunR+2)-dy*dy));if(dx>0)pBox(sunX-dx,sunY+dy,dx*2,3,sunEdge);}
    // Main body with gradient effect - brighter center
    for(let dy=-sunR;dy<=sunR;dy+=3){let dx=Math.sqrt(Math.max(0,sunR*sunR-dy*dy));if(dx>0){
      let distFromCenter=Math.abs(dy)/sunR;
      let bodyCol=lerpC(sunHi,sunCol,distFromCenter*0.7);
      pBox(sunX-dx,sunY+dy,dx*2,3,bodyCol);
    }}
    // Top highlight crescent
    for(let dy=-sunR*0.8;dy<=-sunR*0.1;dy+=3){let dx=Math.sqrt(Math.max(0,(sunR*0.75)*(sunR*0.75)-dy*dy))*0.9;if(dx>0){ctx.globalAlpha=0.5;pBox(sunX-dx-sunR*0.05,sunY+dy,dx*1.5,3,'#ffffdd');}}
    ctx.globalAlpha=1;
    // Bright center hotspot
    let cR=sunR*0.3;
    for(let dy=-cR;dy<=cR;dy+=3){let dx=Math.sqrt(Math.max(0,cR*cR-dy*dy));if(dx>0){ctx.globalAlpha=0.5;pBox(sunX-dx,sunY+dy-sunR*0.05,dx*2,3,'#ffffff');}}
    ctx.globalAlpha=1;
    ctx.restore();
  }
  let bc,gc;
  if(p<0.5){let q=p*2;bc=lerpC('#ddaa55','#ddcc88',q);gc=lerpC('#886622','#448833',q);}
  else{let q=(p-0.5)*2;bc=lerpC('#ddcc88','#88ccee',q);gc=lerpC('#448833','#55aa55',q);}
  for(let x=0;x<W;x+=4){pRect(x,skyH-4,4,bc);pRect(x,skyH,4,gc);}
  ctx.globalAlpha=0.2+p*0.8;clouds.forEach(c=>{c.x+=c.speed;if(c.x>W+c.w)c.x=-c.w*2;drawCloud(c);});ctx.globalAlpha=1;}

function drawGround(){let p=sunProg;
  let c1,c2,c3;
  if(p<0.5){let q=p*2;c1=lerpC('#1a3a1a','#226622',q);c2=lerpC('#0e2a0e','#184418',q);c3=lerpC('#081a08','#0c2c0c',q);}
  else{let q=(p-0.5)*2;c1=lerpC('#226622','#2d8b2d',q);c2=lerpC('#184418','#1a5c1a',q);c3=lerpC('#0c2c0c','#0d3d0d',q);}
  let g=ctx.createLinearGradient(0,skyH,0,H);g.addColorStop(0,c1);g.addColorStop(0.3,c2);g.addColorStop(1,c3);ctx.fillStyle=g;ctx.fillRect(0,skyH,W,H-skyH);for(let x=0;x<W;x+=6)for(let y=Math.floor(skyH);y<H;y+=40){let s=Math.sin(x*0.03+y*0.02)*10,gv=(55+p*35)+s+Math.sin(x*0.1)*5;ctx.fillStyle=`rgb(${Math.floor(12+p*8+s/3)},${Math.floor(gv)},${Math.floor(12+p*8+s/3)})`;ctx.fillRect(x,y+Math.sin(x*0.05)*3,4,3);}}

function drawBgF(f,t){let gp=Math.min(f.gp,1);if(gp<=0)return;let sw=Math.sin(t*0.0015+f.phase)*2.5*gp,px=f.x+sw,py=f.y,s=Math.floor(f.size*gp);if(s<1)return;let sh=f.stemH*gp;for(let sy=0;sy<sh;sy+=3){let w=Math.sin(sy*0.08+t*0.002+f.phase)*1.5;pRect(px+w,py+sy,2,'#2d6b2d');}if(gp>0.3){pRect(px-4,py+sh*0.5,3,'#3da33d');pRect(px+3,py+sh*0.6,3,'#3da33d');}if(gp<0.5)return;if(f.type===0){pRect(px-s,py-s,s,f.col);pRect(px+2,py-s,s,f.col);pRect(px-s,py+2,s,f.col);pRect(px+2,py+2,s,f.col);pRect(px,py,2,'#ffee44');}else if(f.type===1){pRect(px-1,py-s-1,s,f.col);pRect(px-s-1,py,s,f.col);pRect(px+2,py,s,f.col);pRect(px-1,py+s+1,s,f.col);pRect(px,py,3,'#ffee44');}else if(f.type===2){for(let a=0;a<5;a++){let ax=Math.cos(a*Math.PI*2/5)*s,ay=Math.sin(a*Math.PI*2/5)*s;pRect(px+ax,py+ay,s-1,f.col);}pRect(px,py,3,'#ffcc00');}else{pBox(px-s/2,py-s,s+1,s,f.col);pBox(px-s/2-1,py-s+2,s+3,s-2,f.col);pRect(px,py,2,'#ffcc00');}}
function drawPixelLetter(l,cx,cy,sc,col,al){let g=LETTERS[l];if(!g)return;ctx.globalAlpha=al;ctx.fillStyle=col;let ox=cx-(5*sc)/2,oy=cy-(7*sc)/2;for(let r=0;r<7;r++)for(let c=0;c<5;c++)if(g[r][c])ctx.fillRect(Math.floor(ox+c*sc),Math.floor(oy+r*sc),sc,sc);ctx.globalAlpha=1;}
function drawBud(b,t){let ps=isMobile?0.7:1,sway=Math.sin(t*0.002+b.wobble)*4*ps,bx=b.drawX+sway,by=b.drawY,p=b.bloomProgress,gi=b.growIn,sh=b.drawStemH;let stemTop=by-sh*Math.min(p+0.3,1)*gi;for(let sy=by;sy>stemTop;sy-=3){let sw=Math.sin((sy-by)*0.04+t*0.002+b.wobble)*3;pRect(bx+sw-1,sy,4,'#2d8b2d');}let leafY=by-sh*0.4*gi,ls=Math.sin(t*0.003+b.leafPhase)*3,leafS=isMobile?4:6;if(gi>0.4){let la=Math.min((gi-0.4)/0.3,1);ctx.globalAlpha=la;pRect(bx-14*ps+ls,leafY,leafS,'#3da33d');pRect(bx-10*ps+ls,leafY-4*ps,leafS,'#2d8b2d');pRect(bx-7*ps+ls,leafY-7*ps,leafS-1,'#3da33d');pRect(bx+8*ps-ls,leafY+6*ps,leafS,'#2d8b2d');pRect(bx+6*ps-ls,leafY+2*ps,leafS,'#3da33d');pRect(bx+10*ps-ls,leafY+9*ps,leafS-1,'#2d8b2d');ctx.globalAlpha=1;}
let fY=stemTop;if(!b.bloomed){if(gi<0.7)return;let ba=Math.min((gi-0.7)/0.3,1);ctx.globalAlpha=ba;let bs=isMobile?10:14;
    pBox(bx-bs/2-2*ps,fY-2,bs+4*ps,4*ps,'#2d8b2d');
    pBox(bx-bs/2-1,fY-4*ps,3,4*ps,'#3da33d');
    pBox(bx+bs/2-2,fY-4*ps,3,4*ps,'#3da33d');
    pBox(bx-bs/2+1,fY-bs-2,bs-2,3,b.budCol);
    pBox(bx-bs/2,fY-bs+1,bs,bs-2,b.budCol);
    pBox(bx-bs/2+1,fY-1,bs-2,3,b.budCol);
    pBox(bx-bs/4,fY-bs+2,bs/2,bs-4,b.innerCol);
    pBox(bx-bs/3,fY-bs-3,2,3,b.petalCol);
    pBox(bx+bs/3-2,fY-bs-3,2,3,b.petalCol);
    pBox(bx-1,fY-bs-4,2,3,b.midCol);
    ctx.globalAlpha=ba*(0.35+Math.sin(t*0.004+b.wobble)*0.2);pRect(bx-bs/4,fY-bs+2,3,3,'#ffffff');ctx.globalAlpha=1;
}else{let bp=Math.min(p,1),sp2=bp*22*ps,pz=Math.floor((7+bp*7)*ps);for(let a=0;a<8;a++){let ang=(a/8)*Math.PI*2+Math.sin(t*0.001)*0.1,px=bx+Math.cos(ang)*sp2,py=fY-8*ps+Math.sin(ang)*sp2*0.7;pBox(px-pz/2,py-pz/2,pz,pz,b.petalCol);}let ms=Math.floor(8*ps);for(let a=0;a<6;a++){let ang=(a/6)*Math.PI*2+0.3,px=bx+Math.cos(ang)*sp2*0.55,py=fY-8*ps+Math.sin(ang)*sp2*0.4;pBox(px-ms/2,py-ms/2,ms,ms,b.midCol);}let is2=Math.floor(6*ps);for(let a=0;a<4;a++){let ang=(a/4)*Math.PI*2+0.5,px=bx+Math.cos(ang)*sp2*0.3,py=fY-8*ps+Math.sin(ang)*sp2*0.2;pBox(px-is2/2,py-is2/2,is2,is2,b.innerCol);}let cs2=Math.floor(10*ps);pBox(bx-cs2/2,fY-13*ps,cs2,cs2,'#ffee44');pBox(bx-cs2/2+1,fY-12*ps,cs2-2,cs2-2,b.centerCol);if(bp>0.3){let la=Math.min((bp-0.3)/0.5,1),lsc=isMobile?3:4,ly=fY-(isMobile?32:48)-Math.sin(t*0.003+b.wobble)*5;ctx.globalAlpha=la*0.15;ctx.fillStyle=b.petalCol;ctx.fillRect(bx-12,ly-14,24,28);ctx.globalAlpha=1;drawPixelLetter(b.letter,bx+2,ly+2,lsc,'#220011',la*0.6);drawPixelLetter(b.letter,bx,ly,lsc,'#ffffff',la);}}}
function spawnH(x,y,col){for(let i=0;i<8;i++)hearts.push({x,y:y-40,vx:(Math.random()-0.5)*4,vy:-Math.random()*3-1,life:1,size:5+Math.random()*6,col});}
function spawnS(x,y){for(let i=0;i<14;i++)sparkles.push({x,y:y-40,vx:(Math.random()-0.5)*5,vy:(Math.random()-0.5)*5,life:1,col:['#ffee44','#ffffff','#ff9ecf','#ffcc00','#ff6b9d'][Math.floor(Math.random()*5)]});}
function drawHeart(x,y,s,col,al){ctx.globalAlpha=al;pRect(x-s,y-s,s,col);pRect(x+s,y-s,s,col);pRect(x-2*s,y,s,col);pRect(x-s,y,s,col);pRect(x,y,s,col);pRect(x+s,y,s,col);pRect(x+2*s,y,s,col);pRect(x-s,y+s,s,col);pRect(x,y+s,s,col);pRect(x+s,y+s,s,col);pRect(x,y+2*s,s,col);ctx.globalAlpha=1;}

// === CLICK ===
function handleClick(mx,my){let idx=-1;for(let i=0;i<buds.length;i++)if(!buds[i].bloomed&&buds[i].visible&&buds[i].growIn>=0.9){idx=i;break;}if(idx<0)return;let b=buds[idx];if(Math.abs(mx-b.x)<35&&(my-b.y)>-b.stemH-30&&(my-b.y)<10){b.bloomed=true;spawnH(b.x,b.y-b.stemH,b.petalCol);spawnS(b.x,b.y-b.stemH);spawnBgBatch(CS[idx]);if(idx+1<buds.length)buds[idx+1].visible=true;    if(idx===0){sunRising=true;startMusic();}if(idx===1&&!chip.active)startChipmunk();if(idx===3&&!duck.active)startDuck();if(idx===5&&!roo.active)startKangaroo();if(idx===6&&!geese.active)startGeese();updateHint();if(!allDone&&buds.every(b=>b.bloomed)){allDone=true;revT=0;document.getElementById('hint').style.display='none';document.getElementById('hintArrow').style.display='none';let maxY=0;buds.forEach(b=>{if(b.y>maxY)maxY=b.y;});document.getElementById('poem').style.top=(maxY+(isMobile?60:90))+'px';document.getElementById('poem').style.opacity='1';for(let i=0;i<30;i++)setTimeout(()=>{hearts.push({x:W*0.1+Math.random()*W*0.8,y:H*0.5+Math.random()*H*0.3,vx:(Math.random()-0.5)*5,vy:-Math.random()*4-2,life:1,size:4+Math.random()*6,col:['#ff4455','#ffdd33','#4488ff','#aa55dd'][Math.floor(Math.random()*4)]});},i*60);}}}
C.addEventListener('click',e=>handleClick(e.clientX,e.clientY));
C.addEventListener('touchstart',e=>{e.preventDefault();handleClick(e.touches[0].clientX,e.touches[0].clientY);},{passive:false});

// === MAIN LOOP ===
function loop(t){ctx.clearRect(0,0,W,H);drawSky(t);drawGround();bgFQ.forEach(f=>{if(f.delay>0){f.delay--;return;}if(f.gp<1)f.gp+=f.gs;if(f.gp>=1&&!f.done){f.done=true;bgFlowers.push(f);}});bgFQ=bgFQ.filter(f=>!f.done);bgFlowers.forEach(f=>drawBgF(f,t));bgFQ.forEach(f=>{if(f.delay<=0)drawBgF(f,t);});buds.forEach(b=>{if(b.bloomed&&b.bloomProgress<1)b.bloomProgress+=0.015;if(b.visible&&b.growIn<1)b.growIn=Math.min(b.growIn+0.025,1);});buds.forEach(b=>{if(b.visible)drawBud(b,t);});updateHint();updateDuck();drawDuck(t);updateChipmunk();drawChipmunk();updateGeese();drawGeese();updateKangaroo();drawKangaroo(t);updatePizzaRat();drawPizzaRat(t);hearts=hearts.filter(h=>{h.x+=h.vx;h.y+=h.vy;h.vy-=0.02;h.life-=0.01;if(h.life>0){drawHeart(h.x,h.y,h.size/3,h.col,h.life);return true;}return false;});sparkles=sparkles.filter(s=>{s.x+=s.vx;s.y+=s.vy;s.life-=0.018;if(s.life>0){ctx.globalAlpha=s.life;pRect(s.x,s.y,4,s.col);ctx.globalAlpha=1;return true;}return false;});if(allDone){revT++;if(revT%45===0)hearts.push({x:Math.random()*W,y:H+10,vx:(Math.random()-0.5)*1,vy:-Math.random()*1.5-0.5,life:1,size:4+Math.random()*7,col:['#ff4455','#ffdd33','#4488ff','#aa55dd'][Math.floor(Math.random()*4)]});animalTimer++;if(animalTimer>=animalInterval){animalTimer=0;animalInterval=180+Math.floor(Math.random()*180);spawnRandomAnimal();}}requestAnimationFrame(loop);}
requestAnimationFrame(loop);
window.addEventListener('resize',()=>{resize();initAll();});
</script>
</body>
</html>
