<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Happy Valentine's Day, Sohlange!</title>
<link id="favicon" rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect x='2' y='22' width='2' height='10' fill='%232d8b2d'/><rect x='0' y='26' width='3' height='3' fill='%233da33d'/><rect x='4' y='28' width='3' height='3' fill='%233da33d'/><rect x='8' y='6' width='6' height='6' fill='%23ff4455'/><rect x='18' y='6' width='6' height='6' fill='%23ff4455'/><rect x='4' y='10' width='6' height='6' fill='%23ff4455'/><rect x='22' y='10' width='6' height='6' fill='%23ff4455'/><rect x='6' y='14' width='20' height='6' fill='%23ff4455'/><rect x='10' y='8' width='12' height='6' fill='%23ffaaaa'/><rect x='8' y='18' width='16' height='4' fill='%23ff4455'/><rect x='12' y='12' width='8' height='4' fill='%23ffee44'/><rect x='14' y='14' width='4' height='2' fill='%23ffcc00'/></svg>">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { overflow: hidden; background: #0d3d0d; font-family: 'Press Start 2P', monospace; touch-action: manipulation; }
  canvas { display: block; cursor: pointer; }
  #textLayer {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none; display: flex; flex-direction: column; align-items: center;
  }
  #title {
    font-family: 'Press Start 2P', monospace;
    color: #ff6b9d; font-size: 22px; margin-top: 16vh;
    text-shadow: 2px 2px 0 #8b0040, 0 0 12px #ff6b9d88;
    text-align: center; line-height: 1.6;
    animation: pulse 2s ease-in-out infinite;
  }
  #poem {
    font-family: 'Press Start 2P', monospace;
    color: #ffddee; font-size: 13px;
    text-shadow: 1px 1px 0 #8b0040, 0 0 8px #ff6b9d66;
    text-align: center; line-height: 2.2;
    position: absolute; bottom: 32vh; width: 100%;
    opacity: 0; transition: opacity 1.5s ease;
  }
  #hint {
    font-family: 'Press Start 2P', monospace;
    color: #ffee44; font-size: 10px;
    text-shadow: 1px 1px 0 #000, 0 0 6px #ffee4466;
    position: absolute; text-align: center;
    transform: translateX(-50%);
    white-space: nowrap;
    pointer-events: none;
  }
  #hintArrow {
    position: absolute;
    transform: translateX(-50%);
    pointer-events: none;
    animation: bounce 1s ease-in-out infinite;
  }
  @keyframes pulse {
    0%,100% { transform: scale(1); }
    50% { transform: scale(1.03); }
  }
  @keyframes bounce {
    0%,100% { transform: translateX(-50%) translateY(0); }
    50% { transform: translateX(-50%) translateY(8px); }
  }
  @media (max-width: 600px) {
    #title { font-size: 14px; margin-top: 14vh; }
    #poem { font-size: 9px; line-height: 2.4; bottom: 28vh; }
    #hint { font-size: 8px; }
  }
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="textLayer">
  <div id="title">ðŸ’– Happy Valentine's Day ðŸ’–</div>
  <div id="poem">My heart wants to grow<br>Into a field of flowers<br>Beautiful as you</div>
  <div id="hint">Tap!</div>
  <div id="hintArrow">
    <svg width="16" height="20" viewBox="0 0 24 28" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect x="10" y="0" width="4" height="4" fill="#ffee44"/>
      <rect x="10" y="4" width="4" height="4" fill="#ffee44"/>
      <rect x="10" y="8" width="4" height="4" fill="#ffee44"/>
      <rect x="10" y="12" width="4" height="4" fill="#ffee44"/>
      <rect x="2" y="16" width="4" height="4" fill="#ffee44"/>
      <rect x="6" y="16" width="4" height="4" fill="#ffee44"/>
      <rect x="10" y="16" width="4" height="4" fill="#ffee44"/>
      <rect x="14" y="16" width="4" height="4" fill="#ffee44"/>
      <rect x="18" y="16" width="4" height="4" fill="#ffee44"/>
      <rect x="6" y="20" width="4" height="4" fill="#ffee44"/>
      <rect x="10" y="20" width="4" height="4" fill="#ffee44"/>
      <rect x="14" y="20" width="4" height="4" fill="#ffee44"/>
      <rect x="10" y="24" width="4" height="4" fill="#ffee44"/>
    </svg>
  </div>
</div>
<script>
const C = document.getElementById('c');
const ctx = C.getContext('2d');
const dpr = window.devicePixelRatio || 1;
let W, H, isMobile;

function resize() {
  W = window.innerWidth; H = window.innerHeight;
  C.width = W * dpr; C.height = H * dpr;
  C.style.width = W + 'px'; C.style.height = H + 'px';
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  isMobile = W < 600;
}
resize();

function pRect(x,y,s,col) { ctx.fillStyle=col; ctx.fillRect(Math.floor(x),Math.floor(y),s,s); }
function pBox(x,y,w,h,col) { ctx.fillStyle=col; ctx.fillRect(Math.floor(x),Math.floor(y),w,h); }

const LETTERS = {
  S:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],
  O:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],
  H:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],
  L:[[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,1]],
  A:[[0,0,1,0,0],[0,1,0,1,0],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],
  N:[[1,0,0,0,1],[1,1,0,0,1],[1,0,1,0,1],[1,0,0,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],
  G:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,0],[1,0,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],
  E:[[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,1]]
};

const NAME = 'SOHLANGE';

const COLOR_SETS = [
  { bud:'#cc3344', petal:'#ff4455', inner:'#ff8888', mid:'#ffaaaa', center:'#ffcc00' },
  { bud:'#ccaa00', petal:'#ffdd33', inner:'#ffee88', mid:'#fff5bb', center:'#ff9900' },
  { bud:'#3366cc', petal:'#4488ff', inner:'#88bbff', mid:'#aaccff', center:'#ffee44' },
  { bud:'#8833aa', petal:'#aa55dd', inner:'#cc99ee', mid:'#ddbbff', center:'#ffcc00' },
  { bud:'#cc3344', petal:'#ff4455', inner:'#ff8888', mid:'#ffaaaa', center:'#ffcc00' },
  { bud:'#ccaa00', petal:'#ffdd33', inner:'#ffee88', mid:'#fff5bb', center:'#ff9900' },
  { bud:'#3366cc', petal:'#4488ff', inner:'#88bbff', mid:'#aaccff', center:'#ffee44' },
  { bud:'#8833aa', petal:'#aa55dd', inner:'#cc99ee', mid:'#ddbbff', center:'#ffcc00' }
];

let bgFlowers=[], bgFlowerQueue=[], clearZone={x:0,y:0,w:0,h:0};

function makeBgFlowerPositions() {
  let positions=[];
  const spacing=isMobile?34:42;
  const sp=isMobile?36:55;
  const totalBudW=NAME.length*sp+40;
  const startX=(W-totalBudW)/2;
  const baseY=H*0.44;
  const margin=isMobile?10:20;
  clearZone={x:startX-margin,y:baseY-(isMobile?90:130),w:totalBudW+margin*2,h:isMobile?120:165};
  for(let gy=-20;gy<H+spacing;gy+=spacing) for(let gx=-20;gx<W+spacing;gx+=spacing){
    let jx=gx+(Math.random()-0.5)*spacing*0.7,jy=gy+(Math.random()-0.5)*spacing*0.7;
    if(jx>clearZone.x-10&&jx<clearZone.x+clearZone.w+10&&jy>clearZone.y-10&&jy<clearZone.y+clearZone.h+10) continue;
    positions.push({x:jx,y:jy});
  }
  for(let i=positions.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[positions[i],positions[j]]=[positions[j],positions[i]];}
  return positions;
}

let allPositions=[], posIndex=0;

function spawnBgFlowerBatch(cs) {
  const count=Math.ceil(allPositions.length/NAME.length);
  const allCols=[cs.petal,cs.inner,cs.mid,cs.bud];
  for(let i=0;i<count&&posIndex<allPositions.length;i++,posIndex++){
    let pos=allPositions[posIndex];
    bgFlowerQueue.push({x:pos.x,y:pos.y,size:(isMobile?2:3)+Math.floor(Math.random()*(isMobile?3:5)),col:allCols[Math.floor(Math.random()*allCols.length)],phase:Math.random()*Math.PI*2,type:Math.floor(Math.random()*4),stemH:(isMobile?6:8)+Math.random()*(isMobile?10:16),growProgress:0,growSpeed:0.02+Math.random()*0.02,delay:i*2+Math.random()*20});
  }
}

let letterBuds=[], allBloomed=false, revealTimer=0, hearts=[], sparkles=[];

function initLetterBuds() {
  letterBuds=[];
  const sp=isMobile?36:55, totalW=NAME.length*sp, startX=(W-totalW)/2, baseY=H*0.44+(isMobile?12:20);
  for(let i=0;i<NAME.length;i++){
    let cs=COLOR_SETS[i];
    letterBuds.push({x:startX+i*sp+sp/2,y:baseY,letter:NAME[i],bloomed:false,bloomProgress:0,visible:i===0,growIn:i===0?1:0,wobble:Math.random()*Math.PI*2,stemH:isMobile?45+Math.random()*12:65+Math.random()*20,budCol:cs.bud,petalCol:cs.petal,innerCol:cs.inner,midCol:cs.mid,centerCol:cs.center,leafPhase:Math.random()*Math.PI});
  }
}

function updateHintPos() {
  let hint=document.getElementById('hint'), arrow=document.getElementById('hintArrow');
  if(allBloomed){hint.style.display='none';arrow.style.display='none';return;}
  let idx=-1;
  for(let i=0;i<letterBuds.length;i++) if(!letterBuds[i].bloomed&&letterBuds[i].visible&&letterBuds[i].growIn>=0.9){idx=i;break;}
  if(idx<0){hint.style.display='none';arrow.style.display='none';return;}
  let b=letterBuds[idx];
  let budTopY=b.y-b.stemH*0.3-(isMobile?10:14);
  hint.style.top=(budTopY-(isMobile?58:78))+'px';
  hint.style.left=b.x+'px';
  hint.style.display='block';
  arrow.style.top=(budTopY-(isMobile?38:50))+'px';
  arrow.style.left=b.x+'px';
  arrow.style.display='block';
  hint.textContent=isMobile?'Tap!':'Click!';
}

function initAll(){
  bgFlowers=[];bgFlowerQueue=[];posIndex=0;
  allPositions=makeBgFlowerPositions();initLetterBuds();
  allBloomed=false;revealTimer=0;
  document.getElementById('poem').style.opacity='0';
  updateHintPos();
}
initAll();

function drawBg(t) {
  let grd=ctx.createLinearGradient(0,0,0,H);
  grd.addColorStop(0,'#1b5e1b');grd.addColorStop(0.3,'#2d8b2d');grd.addColorStop(0.6,'#1a5c1a');grd.addColorStop(1,'#0d3d0d');
  ctx.fillStyle=grd;ctx.fillRect(0,0,W,H);
  for(let x=0;x<W;x+=6) for(let y=0;y<H;y+=40){let sh=Math.sin(x*0.03+y*0.02)*10,g=90+sh+Math.sin(x*0.1)*5;ctx.fillStyle=`rgb(${20+sh/3},${g},${20+sh/3})`;ctx.fillRect(x,y+Math.sin(x*0.05)*3,4,3);}
  ctx.fillStyle='rgba(0,20,0,0.25)';
  let cz=clearZone,r=12;
  ctx.beginPath();ctx.moveTo(cz.x+r,cz.y);ctx.lineTo(cz.x+cz.w-r,cz.y);ctx.quadraticCurveTo(cz.x+cz.w,cz.y,cz.x+cz.w,cz.y+r);ctx.lineTo(cz.x+cz.w,cz.y+cz.h-r);ctx.quadraticCurveTo(cz.x+cz.w,cz.y+cz.h,cz.x+cz.w-r,cz.y+cz.h);ctx.lineTo(cz.x+r,cz.y+cz.h);ctx.quadraticCurveTo(cz.x,cz.y+cz.h,cz.x,cz.y+cz.h-r);ctx.lineTo(cz.x,cz.y+r);ctx.quadraticCurveTo(cz.x,cz.y,cz.x+r,cz.y);ctx.fill();
}

function drawBgFlower(f,t) {
  let gp=Math.min(f.growProgress,1);if(gp<=0)return;
  let sway=Math.sin(t*0.0015+f.phase)*2.5*gp,px=f.x+sway,py=f.y,s=Math.floor(f.size*gp);if(s<1)return;
  let sh=f.stemH*gp;
  for(let sy=0;sy<sh;sy+=3){let sw=Math.sin(sy*0.08+t*0.002+f.phase)*1.5;pRect(px+sw,py+sy,2,'#2d6b2d');}
  if(gp>0.3){pRect(px-4,py+sh*0.5,3,'#3da33d');pRect(px+3,py+sh*0.6,3,'#3da33d');}
  if(gp<0.5)return;
  if(f.type===0){pRect(px-s,py-s,s,f.col);pRect(px+2,py-s,s,f.col);pRect(px-s,py+2,s,f.col);pRect(px+2,py+2,s,f.col);pRect(px,py,2,'#ffee44');}
  else if(f.type===1){pRect(px-1,py-s-1,s,f.col);pRect(px-s-1,py,s,f.col);pRect(px+2,py,s,f.col);pRect(px-1,py+s+1,s,f.col);pRect(px,py,3,'#ffee44');}
  else if(f.type===2){for(let a=0;a<5;a++){let ax=Math.cos(a*Math.PI*2/5)*s,ay=Math.sin(a*Math.PI*2/5)*s;pRect(px+ax,py+ay,s-1,f.col);}pRect(px,py,3,'#ffcc00');}
  else{pRect(px-s/2,py-s,s+1,f.col);pRect(px-s/2-1,py-s+2,s+3,f.col);pRect(px,py,2,'#ffcc00');}
}

function drawPixelLetter(letter,cx,cy,scale,col,alpha) {
  let grid=LETTERS[letter];if(!grid)return;
  ctx.globalAlpha=alpha;ctx.fillStyle=col;
  let ox=cx-(5*scale)/2,oy=cy-(7*scale)/2;
  for(let r=0;r<7;r++) for(let c=0;c<5;c++) if(grid[r][c]) ctx.fillRect(Math.floor(ox+c*scale),Math.floor(oy+r*scale),scale,scale);
  ctx.globalAlpha=1;
}

function drawBud(b,t) {
  let ps=isMobile?0.7:1;
  let sway=Math.sin(t*0.002+b.wobble)*4*ps,bx=b.x+sway,by=b.y,p=b.bloomProgress;
  let gi=b.growIn;
  let stemTop=by-b.stemH*Math.min(p+0.3,1)*gi;
  for(let sy=by;sy>stemTop;sy-=3){let sw=Math.sin((sy-by)*0.04+t*0.002+b.wobble)*3;pRect(bx+sw-1,sy,4,'#2d8b2d');}
  let leafY=by-b.stemH*0.4*gi,ls=Math.sin(t*0.003+b.leafPhase)*3;
  let leafS=isMobile?4:6;
  if(gi>0.4){
    let la=Math.min((gi-0.4)/0.3,1);
    ctx.globalAlpha=la;
    pRect(bx-14*ps+ls,leafY,leafS,'#3da33d');pRect(bx-10*ps+ls,leafY-4*ps,leafS,'#2d8b2d');pRect(bx-7*ps+ls,leafY-7*ps,leafS-1,'#3da33d');
    pRect(bx+8*ps-ls,leafY+6*ps,leafS,'#2d8b2d');pRect(bx+6*ps-ls,leafY+2*ps,leafS,'#3da33d');pRect(bx+10*ps-ls,leafY+9*ps,leafS-1,'#2d8b2d');
    ctx.globalAlpha=1;
  }
  let flowerY=stemTop;
  if(!b.bloomed){
    if(gi<0.7) return;
    let ba=Math.min((gi-0.7)/0.3,1);
    ctx.globalAlpha=ba;
    let bs=isMobile?10:14;
    pBox(bx-bs/2,flowerY-bs,bs,bs,b.budCol);pBox(bx-bs/2+2,flowerY-bs-4*ps,bs-4,4*ps,b.innerCol);
    pBox(bx-bs/2-3*ps,flowerY-3,bs+6*ps,5*ps,b.petalCol);pBox(bx-bs/2-1,flowerY-6*ps,3,4*ps,b.midCol);pBox(bx+bs/2-2,flowerY-6*ps,3,4*ps,b.midCol);
    ctx.globalAlpha=0.4+Math.sin(t*0.004+b.wobble)*0.25;pRect(bx-2,flowerY-bs+3,4,4,'#ffffff');ctx.globalAlpha=1;
  } else {
    let bp=Math.min(p,1),spread=bp*22*ps,pz=Math.floor((7+bp*7)*ps);
    for(let a=0;a<8;a++){let ang=(a/8)*Math.PI*2+Math.sin(t*0.001)*0.1,px=bx+Math.cos(ang)*spread,py=flowerY-8*ps+Math.sin(ang)*spread*0.7;pBox(px-pz/2,py-pz/2,pz,pz,b.petalCol);}
    let ms=Math.floor(8*ps);
    for(let a=0;a<6;a++){let ang=(a/6)*Math.PI*2+0.3,px=bx+Math.cos(ang)*spread*0.55,py=flowerY-8*ps+Math.sin(ang)*spread*0.4;pBox(px-ms/2,py-ms/2,ms,ms,b.midCol);}
    let is2=Math.floor(6*ps);
    for(let a=0;a<4;a++){let ang=(a/4)*Math.PI*2+0.5,px=bx+Math.cos(ang)*spread*0.3,py=flowerY-8*ps+Math.sin(ang)*spread*0.2;pBox(px-is2/2,py-is2/2,is2,is2,b.innerCol);}
    let cs2=Math.floor(10*ps);
    pBox(bx-cs2/2,flowerY-13*ps,cs2,cs2,'#ffee44');pBox(bx-cs2/2+1,flowerY-12*ps,cs2-2,cs2-2,b.centerCol);
    if(bp>0.3){
      let la=Math.min((bp-0.3)/0.5,1),lsc=isMobile?3:4,ly=flowerY-(isMobile?32:48)-Math.sin(t*0.003+b.wobble)*5;
      ctx.globalAlpha=la*0.15;ctx.fillStyle=b.petalCol;ctx.fillRect(bx-12,ly-14,24,28);ctx.globalAlpha=1;
      drawPixelLetter(b.letter,bx+2,ly+2,lsc,'#220011',la*0.6);
      drawPixelLetter(b.letter,bx,ly,lsc,'#ffffff',la);
    }
  }
}

function spawnHearts(x,y,col){for(let i=0;i<8;i++)hearts.push({x,y:y-40,vx:(Math.random()-0.5)*4,vy:-Math.random()*3-1,life:1,size:5+Math.random()*6,col});}
function spawnSparkles(x,y){for(let i=0;i<14;i++)sparkles.push({x,y:y-40,vx:(Math.random()-0.5)*5,vy:(Math.random()-0.5)*5,life:1,col:['#ffee44','#ffffff','#ff9ecf','#ffcc00','#ff6b9d'][Math.floor(Math.random()*5)]});}

function drawHeart(x,y,s,col,alpha){
  ctx.globalAlpha=alpha;ctx.fillStyle=col;
  pRect(x-s,y-s,s,s,col);pRect(x+s,y-s,s,s,col);
  pRect(x-2*s,y,s,s,col);pRect(x-s,y,s,s,col);pRect(x,y,s,s,col);pRect(x+s,y,s,s,col);pRect(x+2*s,y,s,s,col);
  pRect(x-s,y+s,s,s,col);pRect(x,y+s,s,s,col);pRect(x+s,y+s,s,s,col);pRect(x,y+2*s,s,s,col);
  ctx.globalAlpha=1;
}

function handleClick(mx,my) {
  let nextIdx=-1;
  for(let i=0;i<letterBuds.length;i++) if(!letterBuds[i].bloomed&&letterBuds[i].visible&&letterBuds[i].growIn>=0.9){nextIdx=i;break;}
  if(nextIdx<0) return;
  let b=letterBuds[nextIdx],dx=mx-b.x,dy=my-b.y;
  if(Math.abs(dx)<35&&dy>-b.stemH-30&&dy<10){
    b.bloomed=true;
    spawnHearts(b.x,b.y-b.stemH,b.petalCol);
    spawnSparkles(b.x,b.y-b.stemH);
    spawnBgFlowerBatch(COLOR_SETS[nextIdx]);
    // Reveal next bud
    if(nextIdx+1 < letterBuds.length){
      letterBuds[nextIdx+1].visible=true;
    }
    updateHintPos();
    if(!allBloomed&&letterBuds.every(b=>b.bloomed)){
      allBloomed=true;revealTimer=0;
      document.getElementById('hint').style.display='none';
      document.getElementById('hintArrow').style.display='none';
      document.getElementById('poem').style.opacity='1';
      for(let i=0;i<30;i++) setTimeout(()=>{hearts.push({x:W*0.1+Math.random()*W*0.8,y:H*0.5+Math.random()*H*0.3,vx:(Math.random()-0.5)*5,vy:-Math.random()*4-2,life:1,size:4+Math.random()*6,col:['#ff4455','#ffdd33','#4488ff','#aa55dd'][Math.floor(Math.random()*4)]});},i*60);
    }
  }
}

C.addEventListener('click',(e)=>handleClick(e.clientX,e.clientY));
C.addEventListener('touchstart',(e)=>{e.preventDefault();handleClick(e.touches[0].clientX,e.touches[0].clientY);},{passive:false});

function loop(t) {
  ctx.clearRect(0,0,W,H);
  drawBg(t);

  bgFlowerQueue.forEach(f=>{if(f.delay>0){f.delay--;return;}if(f.growProgress<1)f.growProgress+=f.growSpeed;if(f.growProgress>=1&&!f.done){f.done=true;bgFlowers.push(f);}});
  bgFlowerQueue=bgFlowerQueue.filter(f=>!f.done);
  bgFlowers.forEach(f=>drawBgFlower(f,t));
  bgFlowerQueue.forEach(f=>{if(f.delay<=0)drawBgFlower(f,t);});

  letterBuds.forEach(b=>{
    if(b.bloomed&&b.bloomProgress<1)b.bloomProgress+=0.015;
    if(b.visible&&b.growIn<1)b.growIn=Math.min(b.growIn+0.025,1);
  });
  letterBuds.forEach(b=>{if(b.visible)drawBud(b,t);});
  updateHintPos();

  hearts=hearts.filter(h=>{h.x+=h.vx;h.y+=h.vy;h.vy-=0.02;h.life-=0.01;if(h.life>0){drawHeart(h.x,h.y,h.size/3,h.col,h.life);return true;}return false;});
  sparkles=sparkles.filter(s=>{s.x+=s.vx;s.y+=s.vy;s.life-=0.018;if(s.life>0){ctx.globalAlpha=s.life;pRect(s.x,s.y,4,s.col);ctx.globalAlpha=1;return true;}return false;});

  if(allBloomed){
    revealTimer++;
    if(revealTimer%45===0) hearts.push({x:Math.random()*W,y:H+10,vx:(Math.random()-0.5)*1,vy:-Math.random()*1.5-0.5,life:1,size:4+Math.random()*7,col:['#ff4455','#ffdd33','#4488ff','#aa55dd'][Math.floor(Math.random()*4)]});
  }
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
window.addEventListener('resize',()=>{resize();initAll();});
</script>
</body>
</html>
